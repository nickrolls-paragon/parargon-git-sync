import { ActionStep, ActionTriggerStep } from '@useparagon/core';
import {
  CustomDropdownField,
  UserDefinedComboInputOptions,
  UserDefinedFieldMappingOptions,
} from '@useparagon/core/inputs';
import { IntegrationOptions } from '@useparagon/core/integration';

import { IntentToInputOutput } from './intents';
import { IntentToInputOutput as TriggerIntentToInputOutput } from './triggers';

type ISharepointIntegrationUserDefinedInput = {
  id: string;
  title: string;
  required?: boolean;
  tooltip?: string;
} & (
  | {
      type:
        | 'text'
        | 'number'
        | 'email'
        | 'url'
        | 'boolean'
        | 'password'
        | 'list';
    }
  | {
      type: 'custom_dropdown';
      key: string;
      customDropdownOptions?: CustomDropdownField[];
    }
  | ({
      type: 'custom_item_mapping';
    } & UserDefinedFieldMappingOptions)
  | ({
      type: 'column';
    } & UserDefinedComboInputOptions)
);

/**
 * map b/w input type to result
 */
export type InputResultMap = {
  email: string;
  url: string;
  password: string;
  boolean: boolean;
  text: string;
  number: number;
  custom_dropdown: string;

  list: string;
  column: {
    list: string;
    column: string;
  };
  custom_item_mapping: {
    list: string;
    column: Record<string, any>;
  };
};

/**
 * pass { variableName for input => Input }
 * this should be used whenever we are creating inputs for integrations/workflows
 * as it will infer proper types
 */
export declare const createInputs: <
  T extends Record<string, ISharepointIntegrationUserDefinedInput>,
>(
  inputs: T,
) => T;

/**
 * integration type for sharepoint
 */
export type ISharepointIntegration = {
  /**
   * name of integration
   */
  name: string;

  /**
   * action step methods
   */
  actions: {
    /**
     * Create Item
     * method for SHAREPOINT_CREATE_ITEM
     */
    createItem: (
      inputs: IntentToInputOutput['SHAREPOINT_CREATE_ITEM'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_CREATE_ITEM'][0],
      IntentToInputOutput['SHAREPOINT_CREATE_ITEM'][1]
    >;

    /**
     * Update Item
     * method for SHAREPOINT_UPDATE_ITEM
     */
    updateItem: (
      inputs: IntentToInputOutput['SHAREPOINT_UPDATE_ITEM'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_UPDATE_ITEM'][0],
      IntentToInputOutput['SHAREPOINT_UPDATE_ITEM'][1]
    >;

    /**
     * Get Item by ID
     * method for SHAREPOINT_GET_ITEM_BY_ID
     */
    getItemById: (
      inputs: IntentToInputOutput['SHAREPOINT_GET_ITEM_BY_ID'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_GET_ITEM_BY_ID'][0],
      IntentToInputOutput['SHAREPOINT_GET_ITEM_BY_ID'][1]
    >;

    /**
     * Get Items in a List
     * method for SHAREPOINT_GET_ITEMS_IN_A_LIST
     */
    getItemsInAList: (
      inputs: IntentToInputOutput['SHAREPOINT_GET_ITEMS_IN_A_LIST'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_GET_ITEMS_IN_A_LIST'][0],
      IntentToInputOutput['SHAREPOINT_GET_ITEMS_IN_A_LIST'][1]
    >;

    /**
     * Delete Item
     * method for SHAREPOINT_DELETE_ITEM
     */
    deleteItem: (
      inputs: IntentToInputOutput['SHAREPOINT_DELETE_ITEM'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_DELETE_ITEM'][0],
      IntentToInputOutput['SHAREPOINT_DELETE_ITEM'][1]
    >;

    /**
     * Create List
     * method for SHAREPOINT_CREATE_LIST
     */
    createList: (
      inputs: IntentToInputOutput['SHAREPOINT_CREATE_LIST'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_CREATE_LIST'][0],
      IntentToInputOutput['SHAREPOINT_CREATE_LIST'][1]
    >;

    /**
     * Get List by ID
     * method for SHAREPOINT_GET_LIST_BY_ID
     */
    getListById: (
      inputs: IntentToInputOutput['SHAREPOINT_GET_LIST_BY_ID'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_GET_LIST_BY_ID'][0],
      IntentToInputOutput['SHAREPOINT_GET_LIST_BY_ID'][1]
    >;

    /**
     * Get Lists
     * method for SHAREPOINT_GET_LISTS
     */
    getLists: (
      inputs: IntentToInputOutput['SHAREPOINT_GET_LISTS'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_GET_LISTS'][0],
      IntentToInputOutput['SHAREPOINT_GET_LISTS'][1]
    >;

    /**
     * Create List column
     * method for SHAREPOINT_CREATE_LIST_COLUMN
     */
    createListColumn: (
      inputs: IntentToInputOutput['SHAREPOINT_CREATE_LIST_COLUMN'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_CREATE_LIST_COLUMN'][0],
      IntentToInputOutput['SHAREPOINT_CREATE_LIST_COLUMN'][1]
    >;

    /**
     * Get List columns
     * method for SHAREPOINT_GET_LIST_COLUMNS
     */
    getListColumns: (
      inputs: IntentToInputOutput['SHAREPOINT_GET_LIST_COLUMNS'][0],
      options: IntegrationOptions,
    ) => ActionStep<
      IntentToInputOutput['SHAREPOINT_GET_LIST_COLUMNS'][0],
      IntentToInputOutput['SHAREPOINT_GET_LIST_COLUMNS'][1]
    >;
  };

  /**
   * trigger step methods
   */
  triggers: {
    /**
     * Item Created
     * method for SHAREPOINT_TRIGGER_ITEM_CREATED
     */
    itemCreated: (
      inputs: TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_CREATED'][0],
    ) => ActionTriggerStep<
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_CREATED'][0],
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_CREATED'][1]
    >;

    /**
     * Item Updated
     * method for SHAREPOINT_TRIGGER_ITEM_UPDATED
     */
    itemUpdated: (
      inputs: TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_UPDATED'][0],
    ) => ActionTriggerStep<
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_UPDATED'][0],
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_ITEM_UPDATED'][1]
    >;

    /**
     * File Deleted
     * method for SHAREPOINT_TRIGGER_FILE_DELETED
     */
    fileDeleted: (
      inputs: TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_FILE_DELETED'][0],
    ) => ActionTriggerStep<
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_FILE_DELETED'][0],
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_FILE_DELETED'][1]
    >;

    /**
     * Page Modified
     * method for SHAREPOINT_TRIGGER_PAGE_MODIFIED
     */
    pageModified: (
      inputs: TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_PAGE_MODIFIED'][0],
    ) => ActionTriggerStep<
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_PAGE_MODIFIED'][0],
      TriggerIntentToInputOutput['SHAREPOINT_TRIGGER_PAGE_MODIFIED'][1]
    >;
  };
};
